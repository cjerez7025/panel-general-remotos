<div class="dashboard-container">
  <!-- Header del mockup -->
  <div class="header">
    <h1>Panel General Remotos</h1>
    <div class="date-info">Datos actualizados: {{ (quickStats?.lastUpdateTimestamp | date:'dd/MM/yyyy HH:mm') || 'Cargando...' }}</div>
    <button class="refresh-btn" (click)="refreshData()" [disabled]="loading">
      üîÑ {{ loading ? 'Actualizando...' : 'Actualizar' }}
    </button>
  </div>

  <div class="content-container">
    <!-- Secci√≥n de Warnings (datos reales) -->
    <div class="warning-section" [class.show]="quickStats?.hasSyncIssues || error">
      <div class="warning-title">
        ‚ö†Ô∏è Problemas Detectados en la Estructura de Datos
      </div>
      <ul class="warning-list">
        <li *ngIf="quickStats?.hasSyncIssues">
          ‚ö†Ô∏è SYNC_WARNING: √öltima sincronizaci√≥n hace {{ quickStats?.minutesSinceLastSync }} minutos
        </li>
        <li *ngIf="error">
          ‚ö†Ô∏è CONNECTION_ERROR: {{ error }}
        </li>
        <li *ngIf="(quickStats?.problematicSponsors || 0) > 0">
          ‚ö†Ô∏è SPONSOR_WARNING: {{ quickStats?.problematicSponsors }} sponsors con problemas detectados
        </li>
      </ul>
    </div>

    <!-- Tabs Navigation -->
    <div class="tabs-container">
      <div class="tabs">
        <button class="tab-btn" 
                [class.active]="activeTab === 'llamadas'" 
                (click)="setActiveTab('llamadas')">
          Llamadas por Fecha
        </button>
        <button class="tab-btn" 
                [class.active]="activeTab === 'rendimiento'" 
                (click)="setActiveTab('rendimiento')">
          Rendimiento y M√©tricas
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-overlay">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <p>Sincronizando datos desde Google Sheets...</p>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-overlay">
      <div class="error-content">
        <h3>‚ö†Ô∏è Error de Conexi√≥n</h3>
        <p>{{ error }}</p>
        <button class="retry-btn" (click)="refreshData()">Reintentar</button>
      </div>
    </div>

    <!-- Main Content cuando no hay loading ni error -->
    <div *ngIf="!loading && !error && quickStats">
      
      <!-- TAB 1: Llamadas por Fecha -->
      <div class="tab-content" [class.active]="activeTab === 'llamadas'">
        
        <!-- Vista Principal de Llamadas -->
        <div *ngIf="currentView === 'main'" class="table-section">
          <div class="table-container">
            <table class="summary-table calls-table">
              <thead>
                <tr>
                  <th>Sponsor</th>
                  <th>Ejecutivos Activos</th>
                  <th>Llamadas Hoy</th>
                  <th>Meta Diaria</th>
                  <th>% Progreso</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let sponsor of quickStats?.sponsors; let i = index" 
                    [class]="getSponsorRowClass(sponsor)"
                    (click)="viewSponsorDetail(sponsor)">
                  <td class="row-header">
                    {{ sponsor.sponsorName }}
                    <div *ngIf="sponsor.hasIssues" class="warning-indicator" 
                         [class.error-indicator]="sponsor.severity === 'error'">
                      {{ sponsor.issueCount }}
                    </div>
                  </td>
                  <td><strong>{{ sponsor.activeExecutives | number }}</strong></td>
                  <td><strong>{{ sponsor.callsToday | number }}</strong></td>
                  <td><strong>{{ sponsor.dailyGoal | number }}</strong></td>
                  <td><span [class]="getPercentageClass(sponsor.goalPercentage / 100)">
                    {{ sponsor.goalPercentage }}%
                  </span></td>
                  <td>
                    <span class="status-badge" [style.background-color]="sponsor.colorHex">
                      {{ getStatusText(sponsor.status) }}
                    </span>
                  </td>
                </tr>
                
                <!-- Fila de Totales -->
                <tr class="total-row" *ngIf="quickStats?.sponsors?.length">
                  <td><strong>TOTALES</strong></td>
                  <td><strong>{{ getTotalActiveExecutives() | number }}</strong></td>
                  <td><strong>{{ getTotalCalls() | number }}</strong></td>
                  <td><strong>{{ getTotalTarget() | number }}</strong></td>
                  <td><strong>{{ formatPercentage(getTotalTargetProgress()) }}</strong></td>
                  <td><strong>{{ quickStats?.sponsors?.length }} Sponsors</strong></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Vista Detalle de Sponsor -->
        <div *ngIf="currentView === 'detail' && selectedSponsor" class="table-section">
          <button class="back-btn" (click)="backToMain()">‚Üê Volver al Resumen</button>
          
          <div class="table-header">
            <h3 class="table-title">Detalle por Ejecutivo - {{ selectedSponsor.name }}</h3>
          </div>
          
          <div class="table-container">
            <table class="summary-table calls-table">
              <thead>
                <tr>
                  <th>Ejecutivo</th>
                  <th>Total Leads</th>
                  <th>Llamadas Hechas</th>
                  <th>% Contactabilidad</th>
                  <th>Conectadas</th>
                  <th>% Efectividad</th>
                  <th>Ventas</th>
                  <th>% Conversi√≥n</th>
                  <th>No Conectadas</th>
                  <th>% No Conectadas</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let executive of executiveData" class="executive-row">
                  <td class="executive-name">{{ executive.name }}</td>
                  <td><strong>{{ executive.totalLeads | number }}</strong></td>
                  <td><strong>{{ executive.totalCalls | number }}</strong></td>
                  <td><span [class]="getPercentageClass(executive.contactabilityRate)">
                    {{ formatPercentage(executive.contactabilityRate) }}
                  </span></td>
                  <td><strong>{{ executive.connectedCalls | number }}</strong></td>
                  <td><span [class]="getPercentageClass(executive.effectivenessRate)">
                    {{ formatPercentage(executive.effectivenessRate) }}
                  </span></td>
                  <td><strong>{{ executive.sales | number }}</strong></td>
                  <td><span [class]="getPercentageClass(executive.conversionRate)">
                    {{ formatPercentage(executive.conversionRate) }}
                  </span></td>
                  <td><strong>{{ executive.notConnectedCalls | number }}</strong></td>
                  <td><span [class]="getPercentageClass(executive.notConnectedRate, true)">
                    {{ formatPercentage(executive.notConnectedRate) }}
                  </span></td>
                </tr>
                
                <!-- Totales del Sponsor -->
                <tr class="total-row">
                  <td><strong>TOTALES {{ selectedSponsor.name }}</strong></td>
                  <td><strong>{{ selectedSponsor.totalLeads | number }}</strong></td>
                  <td><strong>{{ selectedSponsor.totalCalls | number }}</strong></td>
                  <td><strong>{{ formatPercentage(selectedSponsor.contactabilityRate) }}</strong></td>
                  <td><strong>{{ selectedSponsor.connectedCalls | number }}</strong></td>
                  <td><strong>{{ formatPercentage(selectedSponsor.effectivenessRate) }}</strong></td>
                  <td><strong>{{ selectedSponsor.sales | number }}</strong></td>
                  <td><strong>{{ formatPercentage(selectedSponsor.conversionRate) }}</strong></td>
                  <td><strong>{{ selectedSponsor.notConnectedCalls | number }}</strong></td>
                  <td><strong>{{ formatPercentage(selectedSponsor.notConnectedRate) }}</strong></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>

      <!-- TAB 2: Rendimiento y M√©tricas -->
      <div class="tab-content" [class.active]="activeTab === 'rendimiento'">
        
        <!-- M√©tricas Generales Grid - DATOS REALES -->
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-icon">üìû</div>
            <div class="metric-content">
              <h4>{{ quickStats?.totalCallsToday | number }}</h4>
              <p>Total Llamadas Hoy</p>
              <small>Desde todos los sponsors</small>
            </div>
          </div>
          
          <div class="metric-card">
            <div class="metric-icon">üéØ</div>
            <div class="metric-content">
              <h4>{{ quickStats?.totalDailyGoal | number }}</h4>
              <p>Meta Diaria Total</p>
              <small>{{ formatPercentage(quickStats?.goalProgressPercentage / 100) }} completado</small>
            </div>
          </div>
          
          <div class="metric-card">
            <div class="metric-icon">üë•</div>
            <div class="metric-content">
              <h4>{{ quickStats?.totalActiveExecutives | number }}</h4>
              <p>Ejecutivos Activos</p>
              <small>{{ formatNumber(quickStats?.averageCallsPerExecutive) }} llamadas promedio</small>
            </div>
          </div>
          
          <div class="metric-card">
            <div class="metric-icon">üìä</div>
            <div class="metric-content">
              <h4>{{ quickStats?.activeSponsors | number }}</h4>
              <p>Sponsors Activos</p>
              <small>{{ quickStats?.problematicSponsors || 0 }} con problemas</small>
            </div>
          </div>
        </div>

        <!-- Tabla de Rendimiento Detallada - SOLO DATOS REALES -->
        <div class="table-section">
          <div class="table-header">
            <h3 class="table-title">An√°lisis de Rendimiento por Sponsor</h3>
            <p class="table-subtitle">Datos reales de Google Sheets</p>
          </div>
          
          <div class="table-container">
            <table class="summary-table performance-table">
              <thead>
                <tr>
                  <th>Sponsor</th>
                  <th>Ejecutivos</th>
                  <th>Llamadas Hoy</th>
                  <th>Meta Diaria</th>
                  <th>% Progreso</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let sponsor of quickStats?.sponsors">
                  <!-- Solo datos reales del backend -->
                  <tr [class]="getSponsorRowClass(sponsor)" (click)="toggleSponsorExpansion(sponsor)">
                    <td class="row-header">
                      <span class="sponsor-toggle">{{ sponsor.expanded ? '‚ñº' : '‚ñ∂' }}</span>
                      {{ sponsor.sponsorName }}
                      <div *ngIf="sponsor.hasIssues" class="warning-indicator" 
                           [class.error-indicator]="sponsor.severity === 'error'">
                        {{ sponsor.issueCount }}
                      </div>
                    </td>
                    <td><strong>{{ sponsor.activeExecutives | number }}</strong></td>
                    <td><strong>{{ sponsor.callsToday | number }}</strong></td>
                    <td><strong>{{ sponsor.dailyGoal | number }}</strong></td>
                    <td><span [class]="getPercentageClass(sponsor.goalPercentage / 100)">
                      {{ sponsor.goalPercentage }}%
                    </span></td>
                    <td>
                      <span class="status-badge" [style.background-color]="sponsor.colorHex">
                        {{ getStatusText(sponsor.status) }}
                      </span>
                    </td>
                  </tr>
                  
                  <!-- Ejecutivos (cuando se expande) -->
                  <ng-container *ngIf="sponsor.expanded">
                    <tr *ngFor="let executive of sponsor.executives" class="executive-row">
                      <td class="executive-name">{{ executive.name }}</td>
                      <td>-</td>
                      <td><strong>{{ executive.callsToday || 0 | number }}</strong></td>
                      <td><strong>{{ executive.dailyGoal || 0 | number }}</strong></td>
                      <td><span [class]="getPercentageClass(executive.goalPercentage / 100)">
                        {{ executive.goalPercentage || 0 }}%
                      </span></td>
                      <td>{{ getStatusText(executive.status || 0) }}</td>
                    </tr>
                  </ng-container>
                </ng-container>
                
                <!-- Totales reales -->
                <tr class="total-row" *ngIf="quickStats?.sponsors?.length">
                  <td><strong>TOTALES REALES</strong></td>
                  <td><strong>{{ getTotalActiveExecutives() | number }}</strong></td>
                  <td><strong>{{ getTotalCalls() | number }}</strong></td>
                  <td><strong>{{ getTotalTarget() | number }}</strong></td>
                  <td><strong>{{ formatPercentage(getTotalTargetProgress()) }}</strong></td>
                  <td><strong>{{ quickStats?.sponsors?.length }} Sponsors</strong></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>

    </div>

    <!-- Informaci√≥n adicional -->
    <div *ngIf="!loading && !error" class="info-section">
      <strong>Informaci√≥n del Sistema:</strong><br>
      ‚Ä¢ Los datos se sincronizan autom√°ticamente cada 15 minutos desde Google Sheets<br>
      ‚Ä¢ Las m√©tricas de rendimiento se calculan en tiempo real<br>
      ‚Ä¢ Los indicadores de color: üü¢ Excelente (>80%) | üîµ Bueno (60-80%) | üü° Regular (40-60%) | üî¥ Pobre (<40%)<br>
      ‚Ä¢ Estado del sistema: {{ getSystemStatusText((syncStatus && syncStatus[0]) ? syncStatus[0].status : 0) }}<br>
      ‚Ä¢ √öltima actualizaci√≥n exitosa: {{ quickStats?.lastUpdateTimestamp || 'Desconocida' }}
    </div>

  </div>
</div>