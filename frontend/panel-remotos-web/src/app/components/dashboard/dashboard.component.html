<div class="dashboard-container">
  <!-- Header del mockup -->
  <div class="header">
    <h1>Panel General Remotos</h1>
    <div class="date-info">Datos actualizados: {{ (quickStats?.lastUpdateTimestamp | date:'dd/MM/yyyy HH:mm') || 'Cargando...' }}</div>
    <button class="refresh-btn" (click)="refreshData()" [disabled]="loading">
      üîÑ {{ loading ? 'Actualizando...' : 'Actualizar' }}
    </button>
  </div>

  <div class="content-container">
    <!-- Secci√≥n de Warnings (datos reales) -->
    <div class="warning-section" [class.show]="quickStats?.hasSyncIssues || error">
      <div class="warning-title">
        ‚ö†Ô∏è Problemas Detectados en la Estructura de Datos
      </div>
      <ul class="warning-list">
        <li *ngIf="quickStats?.hasSyncIssues">
          ‚ö†Ô∏è SYNC_WARNING: √öltima sincronizaci√≥n hace {{ quickStats?.minutesSinceLastSync }} minutos
        </li>
        <li *ngIf="error">
          ‚ö†Ô∏è CONNECTION_ERROR: {{ error }}
        </li>
        <li *ngIf="(quickStats?.problematicSponsors || 0) > 0">
          ‚ö†Ô∏è SPONSOR_WARNING: {{ quickStats?.problematicSponsors }} sponsors con problemas detectados
        </li>
      </ul>
    </div>

    <!-- Tabs Navigation -->
    <div class="tabs-container">
      <div class="tabs">
        <button class="tab-btn" 
                [class.active]="activeTab === 'llamadas'" 
                (click)="setActiveTab('llamadas')">
          Llamadas por Fecha
        </button>
        <button class="tab-btn" 
                [class.active]="activeTab === 'rendimiento'" 
                (click)="setActiveTab('rendimiento')">
          Rendimiento y M√©tricas
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-overlay">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <p>Sincronizando datos desde Google Sheets...</p>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-overlay">
      <div class="error-content">
        <h3>‚ö†Ô∏è Error de Conexi√≥n</h3>
        <p>{{ error }}</p>
        <button class="retry-btn" (click)="refreshData()">Reintentar</button>
      </div>
    </div>

    <!-- Tab Content: Llamadas por Fecha (con drill-down) -->
    <div class="tab-content" [class.active]="activeTab === 'llamadas'" *ngIf="quickStats && !loading">
      
      <!-- Vista Principal -->
      <div *ngIf="currentView === 'main'" class="main-view">
        <div class="table-container">
          <table class="summary-table calls-table">
            <thead>
              <tr>
                <th>Sponsor</th>
                <th>Ejecutivos</th>
                <th>Llamadas Hoy</th>
                <th>Meta Diaria</th>
                <th>Progreso %</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr class="sponsor-row" 
                  *ngFor="let sponsor of quickStats.sponsorBreakdown"
                  (click)="drillDownSponsor(sponsor)">
                <td class="row-header">
                  {{ sponsor.sponsorName }}
                  <span class="drill-indicator">‚ñ∂</span>
                </td>
                <td>{{ sponsor.activeExecutives }}</td>
                <td class="calls-count">{{ sponsor.callsToday }}</td>
                <td class="goal-count">{{ sponsor.dailyGoal }}</td>
                <td class="percentage" [ngClass]="getPercentageClass(sponsor.goalPercentage)">
                  {{ sponsor.goalPercentage }}%
                </td>
                <td>
                  <span class="status-badge" [ngClass]="getStatusClass(sponsor.status)">
                    {{ getStatusText(sponsor.status) }}
                  </span>
                </td>
                <td>
                  <button class="action-btn" (click)="$event.stopPropagation(); drillDownSponsor(sponsor)">
                    Ver Detalle
                  </button>
                </td>
              </tr>
              <tr class="total-row">
                <td><strong>TOTAL</strong></td>
                <td><strong>{{ quickStats.totalActiveExecutives }}</strong></td>
                <td><strong>{{ quickStats.totalCallsToday }}</strong></td>
                <td><strong>{{ quickStats.totalDailyGoal }}</strong></td>
                <td class="percentage excellent">
                  <strong>{{ quickStats.goalProgressPercentage }}%</strong>
                </td>
                <td>
                  <span class="status-badge" [ngClass]="getSystemStatusClass(quickStats.systemStatus)">
                    {{ getSystemStatusText(quickStats.systemStatus) }}
                  </span>
                </td>
                <td>
                  <button class="action-btn primary" (click)="forceRefresh()">
                    üîÑ Sincronizar
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Gr√°fico principal -->
        <div class="chart-section">
          <div class="chart-header">
            <h3>üìä Distribuci√≥n de Llamadas por Sponsor</h3>
          </div>
          <div class="chart-container">
            <highcharts-chart 
              [Highcharts]="Highcharts"
              [options]="callsChartOptions">
            </highcharts-chart>
          </div>
        </div>
      </div>

      <!-- Vista de Drill-Down (Detalle por Ejecutivos) -->
      <div *ngIf="currentView === 'detail'" class="detail-view">
        <!-- Back button -->
        <button class="back-btn" (click)="backToMain()">
          ‚óÄ Volver al Resumen General
        </button>

        <!-- Header del drill-down -->
        <div class="detail-header">
          <h3>Detalle de Ejecutivos - {{ selectedSponsor?.sponsorName }}</h3>
          <div class="detail-summary">
            <span class="summary-item">
              <strong>{{ selectedSponsor?.activeExecutives }}</strong> Ejecutivos Activos
            </span>
            <span class="summary-item">
              <strong>{{ selectedSponsor?.callsToday }}</strong> Llamadas Hoy
            </span>
            <span class="summary-item">
              <strong>{{ selectedSponsor?.goalPercentage }}%</strong> Progreso
            </span>
          </div>
        </div>

        <!-- Tabla de ejecutivos -->
        <div class="table-container">
          <table class="summary-table executive-table">
            <thead>
              <tr>
                <th>Ejecutivo</th>
                <th>Equipo</th>
                <th>Llamadas</th>
                <th>Meta</th>
                <th>% Avance</th>
                <th>Contactados</th>
                <th>Interesados</th>
                <th>Cerrados</th>
                <th>Rendimiento</th>
              </tr>
            </thead>
            <tbody>
              <tr class="executive-row" *ngFor="let executive of executiveData">
                <td class="executive-name">{{ executive.name }}</td>
                <td>{{ executive.team }}</td>
                <td>{{ executive.callsToday }}</td>
                <td>{{ executive.goal }}</td>
                <td class="percentage" [ngClass]="getPercentageClass(executive.percentage)">
                  {{ executive.percentage }}%
                </td>
                <td>{{ executive.contactados }}</td>
                <td>{{ executive.interesados }}</td>
                <td>{{ executive.cerrados }}</td>
                <td>
                  <span class="rendimiento" [ngClass]="getRendimientoClass(executive.percentage)">
                    {{ getRendimientoText(executive.percentage) }}
                  </span>
                </td>
              </tr>
              <tr class="total-row">
                <td><strong>TOTAL {{ selectedSponsor?.sponsorName }}</strong></td>
                <td>{{ selectedSponsor?.activeExecutives }} equipos</td>
                <td><strong>{{ calculateExecutiveTotal('callsToday') }}</strong></td>
                <td><strong>{{ calculateExecutiveTotal('goal') }}</strong></td>
                <td class="percentage excellent">
                  <strong>{{ selectedSponsor?.goalPercentage }}%</strong>
                </td>
                <td><strong>{{ calculateExecutiveTotal('contactados') }}</strong></td>
                <td><strong>{{ calculateExecutiveTotal('interesados') }}</strong></td>
                <td><strong>{{ calculateExecutiveTotal('cerrados') }}</strong></td>
                <td>
                  <span class="rendimiento" [ngClass]="getRendimientoClass(selectedSponsor?.goalPercentage)">
                    <strong>{{ getRendimientoText(selectedSponsor?.goalPercentage) }}</strong>
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Gr√°fico del sponsor espec√≠fico -->
        <div class="chart-section">
          <div class="chart-header">
            <h3>üìà Rendimiento por Ejecutivo - {{ selectedSponsor?.sponsorName }}</h3>
          </div>
          <div class="chart-container">
            <highcharts-chart 
              [Highcharts]="Highcharts"
              [options]="executiveChartOptions">
            </highcharts-chart>
          </div>
        </div>
      </div>

      <div class="info-section">
        <strong>üí° Informaci√≥n:</strong> 
        <span *ngIf="currentView === 'main'">
          Haga clic en cualquier fila de sponsor para ver el detalle por ejecutivo.
        </span>
        <span *ngIf="currentView === 'detail'">
          Mostrando detalle de ejecutivos para {{ selectedSponsor?.sponsorName }}.
        </span>
        Datos actualizados cada {{ (quickStats?.minutesSinceLastSync) || 30 }} minutos desde Google Sheets.
        <strong>Sistema:</strong> {{ getSystemStatusText(quickStats.systemStatus) }}
      </div>
    </div>

    <!-- Tab Content: Rendimiento y M√©tricas (con datos reales) -->
    <div class="tab-content" [class.active]="activeTab === 'rendimiento'" *ngIf="quickStats && !loading">
      <div class="table-container">
        <table class="summary-table performance-table">
          <thead>
            <tr>
              <th>Sponsor</th>
              <th>Ejecutivos</th>
              <th>Llamadas</th>
              <th>Meta</th>
              <th>% Avance</th>
              <th>Contactados</th>
              <th>% Contacto</th>
              <th>Eficiencia</th>
              <th>Rendimiento</th>
            </tr>
          </thead>
          <tbody>
            <tr class="sponsor-row" 
                *ngFor="let sponsor of quickStats.sponsorBreakdown"
                (click)="drillDownSponsor(sponsor)">
              <td class="row-header">
                {{ sponsor.sponsorName }}
                <span class="drill-indicator">‚ñ∂</span>
              </td>
              <td>{{ sponsor.activeExecutives }}</td>
              <td>{{ sponsor.callsToday }}</td>
              <td>{{ sponsor.dailyGoal }}</td>
              <td class="percentage" [ngClass]="getPercentageClass(sponsor.goalPercentage)">
                {{ sponsor.goalPercentage }}%
              </td>
              <td>{{ calculateContactados(sponsor.callsToday) }}</td>
              <td class="percentage" [ngClass]="getContactPercentageClass()">
                {{ quickStats.contactedPercentage }}%
              </td>
              <td class="percentage" [ngClass]="getEfficiencyClass(sponsor.goalPercentage)">
                {{ calculateEfficiency(sponsor.goalPercentage) }}%
              </td>
              <td>
                <span class="rendimiento" [ngClass]="getRendimientoClass(sponsor.goalPercentage)">
                  {{ getRendimientoText(sponsor.goalPercentage) }}
                </span>
              </td>
            </tr>
            <tr class="total-row">
              <td><strong>TOTAL</strong></td>
              <td><strong>{{ quickStats.totalActiveExecutives }}</strong></td>
              <td><strong>{{ quickStats.totalCallsToday }}</strong></td>
              <td><strong>{{ quickStats.totalDailyGoal }}</strong></td>
              <td class="percentage excellent">
                <strong>{{ quickStats.goalProgressPercentage }}%</strong>
              </td>
              <td><strong>{{ calculateContactados(quickStats.totalCallsToday) }}</strong></td>
              <td class="percentage good">
                <strong>{{ quickStats.contactedPercentage }}%</strong>
              </td>
              <td class="percentage excellent">
                <strong>{{ calculateEfficiency(quickStats.goalProgressPercentage) }}%</strong>
              </td>
              <td>
                <span class="rendimiento excellent">
                  <strong>{{ getRendimientoText(quickStats.goalProgressPercentage) }}</strong>
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Gr√°fico de rendimiento -->
      <div class="chart-section">
        <div class="chart-header">
          <h3>üìà Tendencia de Rendimiento</h3>
        </div>
        <div class="chart-container">
          <highcharts-chart 
            [Highcharts]="Highcharts"
            [options]="performanceChartOptions">
          </highcharts-chart>
        </div>
      </div>

      <!-- M√©tricas adicionales con datos reales -->
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-icon">üë•</div>
          <div class="metric-content">
            <h4>{{ quickStats.totalActiveExecutives }}</h4>
            <p>Ejecutivos Activos</p>
            <small>Promedio: {{ quickStats.averageCallsPerExecutive | number:'1.1-1' }} llamadas/ejecutivo</small>
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-icon">üìû</div>
          <div class="metric-content">
            <h4>{{ quickStats.contactedPercentage }}%</h4>
            <p>Tasa de Contacto</p>
            <small>{{ calculateContactados(quickStats.totalCallsToday) }} contactos exitosos</small>
          </div>
        </div>
        
        <div class="metric-card">
          <div class